<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no,viewport-fit=cover" />
  <script>
      ;(function(docEl, t, padBaseSize){
          var w,r=function(){
              var nw=Math.min(docEl.getBoundingClientRect().width, padBaseSize)
              if(nw!==w) w=nw,docEl.setAttribute('style','font-size:'+w/10+'px')
          }
          if(t.setAttribute('style','width:1vw'), !t.style.width) r(),window.addEventListener('resize', r)
      })(document.documentElement, document.createElement('div'), 750);
  </script>
  <meta name="format-detection" content="telephone=no,email=no">
  <title>测测你能承受多少Pa</title>

</head>
<body>
  <div id="app"></div>
  <audio id="audio" loop>
    <source src="https://hd.huya.com/entertainWeekly15/bg.mp3" type="audio/mpeg">
    Your browser does not support the audio tag.
  </audio>
  <script>
      //----------页面初始化------------
      var audiobg = document.getElementById('audio');
      if(sessionStorage.bgmusic=='pause'){
          playBgMusic(false);
      }else{
          playBgMusic(true);
          //----------处理自动播放------------
          //--创建页面监听，等待微信端页面加载完毕 触发音频播放
          document.addEventListener('DOMContentLoaded', function () {
              function audioAutoPlay() {
                  playBgMusic(true);
                  document.addEventListener("WeixinJSBridgeReady", function () {
                      playBgMusic(true);
                  }, false);
              }
              audioAutoPlay();
          });
          //--创建触摸监听，当浏览器打开页面时，触摸屏幕触发事件，进行音频播放
          function audioAutoPlay() {
              playBgMusic(true);
              document.removeEventListener('touchstart',audioAutoPlay);
          }
          document.addEventListener('touchstart', audioAutoPlay);
      }
      //----------处理页面激活------------
      var hiddenProperty = 'hidden' in document ? 'hidden' :
          'webkitHidden' in document ? 'webkitHidden' :
              'mozHidden' in document ? 'mozHidden' :
                  null;
      var visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');
      var onVisibilityChange = function(){
          if (!document[hiddenProperty]) {
              if(!sessionStorage.bgmusic||sessionStorage.bgmusic=='play'){
                  audiobg.play();
              }
          }else{
              audiobg.pause();
          }
      }
      document.addEventListener(visibilityChangeEvent, onVisibilityChange);
      //---------背景音乐开关----------
      function triggerBgMusic(){
          if(!sessionStorage.bgmusic||sessionStorage.bgmusic=='play'){
              playBgMusic(false);
          }else{
              playBgMusic(true);
          }
      }
      //---------音乐播放和暂停----------
      function playBgMusic(val){

          if(val){
              audiobg.play();
              audiobg.loop;
              sessionStorage.bgmusic='play';
          }else{
              audiobg.pause();
              audiobg.loop;
              sessionStorage.bgmusic='pause';
          }
      }
  </script>
</body>
</html>
